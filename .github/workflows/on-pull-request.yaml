name: Continous Integration

on:
  pull_request:

permissions:
  id-token: write
  contents: read
  deployments: write

jobs:
  verify:
    name: ðŸ§ª Verify code changes
    uses: ./.github/workflows/workflow-lint.yaml
    with:
      ESLINT_REPORTER: 'github-pr-check'

  deploy_preview:
    name: ðŸš€ Deploy devmint.pl as preview URL
    uses: ./.github/workflows/workflow-cloudflare.yaml
    needs: verify
    if: github.event.pull_request.draft == false
    with:
      package_name: 'packages/devmint-pl'
    secrets:
      cloudflare_token: ${{ secrets.CLOUDFLARE_API_TOKEN }}
      cloudflare_account: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
      gh_token: ${{ secrets.GITHUB_TOKEN }}
