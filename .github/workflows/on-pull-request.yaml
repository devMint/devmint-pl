name: Continous Integration

on:
  pull_request:

permissions:
  id-token: write
  contents: read
  deployments: write

jobs:
  verify:
    name: ðŸ§ª Verify code changes
    uses: ./.github/workflows/workflow-lint.yaml
    with:
      ESLINT_REPORTER: 'github-pr-check'

  deploy_preview:
    name: ðŸš€ Deploy preview
    uses: ./.github/workflows/workflow-cloudflare.yaml
    needs: verify
    if: github.event.pull_request.draft == false
    secrets:
      CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
      CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
